<!DOCTYPE html>
<meta charset="utf-8" />

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Medical Condition vs Admission Type</title>
  <h1>Medical Condition vs Admission Type</h1>
  <style>
    .home-button {
      padding: 10px 20px;
      margin: 10px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #4caf50;
      color: white;
      font-size: 16px;
      position: fixed;
      bottom: 50px;
      right: 50px;
    }

    .home-button:hover {
      background-color: #45a049;
    }
  </style>
</head>

<script src="https://d3js.org/d3.v4.js"></script>
<div style="display: flex; justify-content: center">
  <div id="my_dataviz"></div>
  <div id="legend-container" style="margin-left: 20px; margin-top: 100px"></div>
</div>
<div>
  <button class="home-button" onclick="returnHome()">Return Home</button>
</div>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script>
  var margin = { top: 80, right: 230, bottom: 50, left: 130 },
    width = 1000 - margin.left - margin.right,
    height = 550 - margin.top - margin.bottom;
  // The SVG for the vis
  var svg = d3
    .select("#my_dataviz")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  // Loading data
  d3.csv("q2.csv", function (data) {
    // x-axis
    var x = d3
      .scaleBand()
      .range([0, width])
      .domain(
        data.map(function (d) {
          return d["Medical Condition"];
        })
      )
      .padding(0.05);

    svg
      .append("g")
      .style("font-size", 15)
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x).tickSize(0))
      .select(".domain")
      .remove();
    svg
      .append("text")
      .attr("x", width / 2)
      .attr("y", height + 40)
      .style("text-anchor", "middle")
      .text("Medical Condition");

    // y-axis
    var y = d3
      .scaleBand()
      .range([height, 0])
      .domain(
        data.map(function (d) {
          return d["Admission Type"];
        })
      )
      .padding(0.05);
    svg
      .append("g")
      .style("font-size", 15)
      .call(d3.axisLeft(y).tickSize(0))
      .select(".domain")
      .remove();
    svg
      .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", -margin.left)
      .attr("x", -height / 2)
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .text("Admission Type");

    // color scale
    var myColor = d3
      .scaleSequential()
      .interpolator(d3.interpolateViridis)
      .domain([1, 25]);

    // Create the heatmap rectangles
    svg
      .selectAll()
      .data(data)
      .enter()
      .append("rect")
      .attr("x", function (d) {
        return x(d["Medical Condition"]);
      })
      .attr("y", function (d) {
        return y(d["Admission Type"]);
      })
      .attr("rx", 4)
      .attr("ry", 4)
      .attr("width", x.bandwidth())
      .attr("height", y.bandwidth())
      .style("fill", function (d) {
        return myColor(d["Duration of Stay"]); //Colored according to the value
      })
      .style("stroke-width", 4)
      .style("stroke", "none")
      .style("opacity", 0.8)
      .on("mouseover", function (d) {
        //Functions on hover
        tooltip.style("visibility", "visible");
        d3.select(this).style("stroke", "black").style("opacity", 1);
      })
      .on("mousemove", function (d) {
        tooltip
          .html(
            "Duration of Stay: " +
              d["Duration of Stay"] +
              " Days" +
              "<br>" +
              "Medical Condition: " +
              d["Medical Condition"] +
              "<br>" +
              "Admission Type: " +
              d["Admission Type"]
          )
          .style("left", event.pageX + 10 + "px")
          .style("top", event.pageY - 20 + "px");
      })
      .on("mouseleave", function (d) {
        tooltip.style("visibility", "hidden");
        d3.select(this).style("stroke", "none").style("opacity", 0.8);
      });

    //function to make the legend
    function generateColorLegend(minValue, maxValue, colorScale) {
      const legendContainer = document.getElementById("legend-container");
      const numSteps = 500;
      const stepSize = (maxValue - minValue) / numSteps;
      const legendWidth = 40;
      const legendHeight = 300;

      let legendHTML = `<div id="legend-container-inner" style="display: flex; align-items: center;">
    <div id="legend" style="height: ${legendHeight}px; width: ${legendWidth}px; display: flex; flex-direction: column; justify-content: space-between;">`;

      // Generate legend elements
      for (let i = 0; i <= numSteps; i++) {
        const value = minValue + i * stepSize;
        const color = colorScale(value);
        legendHTML += `<div style="height: ${
          100 / numSteps
        }%; background-color: ${color};"></div>`;
      }

      legendHTML += `</div>`;

      const labels = [1, 5, 10, 15, 25];
      const labelContainerWidth = 120;

      legendHTML += `<div style="position: relative; height: ${legendHeight}px; margin-left: 0px;">`;

      for (let i = 0; i < labels.length; i++) {
        const labelTop = (i / (labels.length - 1)) * 93 + "%";
        if (labels[i] === 1) {
          legendHTML += `<div style="position: absolute; top: ${labelTop}; width: ${labelContainerWidth}px; text-align: center; font-size: 15px;">${labels[i]} day</div>`;
        } else {
          legendHTML += `<div style="position: absolute; top: ${labelTop}; width: ${labelContainerWidth}px; text-align: center; font-size: 15px;">${labels[i]} days</div>`;
        }
      }

      legendHTML += `</div></div>`;

      legendContainer.innerHTML = legendHTML;
    }

    //generate the legend
    const minValue = 0;
    const maxValue = 25;
    generateColorLegend(minValue, maxValue, myColor);

    // Create the tooltip
    var tooltip = d3
      .select("body")
      .append("div")
      .style("position", "absolute")
      .style("visibility", "hidden")
      .style("background-color", "white")
      .style("border", "solid")
      .style("border-width", "1px")
      .style("border-radius", "5px")
      .style("padding", "10px");
  });
  function returnHome() {
    window.location.href = "index.html";
  }
</script>
